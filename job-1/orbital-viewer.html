<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orbital Energy Calculator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .input-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .orbital-input {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
        }
        
        .orbital-input label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .input-group select {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: white;
        }
        
        .input-group input {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .orbital-info {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
            background: #e3f2fd;
            padding: 8px;
            border-radius: 4px;
            border-left: 3px solid #1976d2;
        }
        
        .energy-gap {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 6px;
            margin-top: 20px;
        }
        
        .energy-gap h3 {
            margin: 0 0 10px 0;
            color: #1976d2;
        }
        
        .chart-container {
            margin-top: 20px;
            height: 400px;
            position: relative;
        }
        
        .energy-value {
            margin-top: 5px;
            color: #666;
        }
        
        .error {
            color: #d32f2f;
            background: #ffebee;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Orbital Energy Calculator</h1>
        
        <div class="input-section">
            <div class="orbital-input">
                <label for="orbital1-select">Orbital 1:</label>
                <div class="input-group">
                    <select id="orbital1-select" onchange="handleSelectChange('orbital1')">
                        <option value="custom">Custom</option>
                        <option value="HOMO">HOMO</option>
                        <option value="LUMO" selected>LUMO</option>
                        <option value="HOMO-1">HOMO-1</option>
                        <option value="LUMO+1">LUMO+1</option>
                    </select>
                    <input type="number" id="orbital1" placeholder="Enter index">
                </div>
                <div class="orbital-info" id="orbital1-info">
                    Reference: HOMO = <span id="homo-index1">...</span>, LUMO = <span id="lumo-index1">...</span>
                </div>
                <div class="energy-value" id="energy1"></div>
            </div>
            
            <div class="orbital-input">
                <label for="orbital2-select">Orbital 2:</label>
                <div class="input-group">
                    <select id="orbital2-select" onchange="handleSelectChange('orbital2')">
                        <option value="custom">Custom</option>
                        <option value="HOMO" selected>HOMO</option>
                        <option value="LUMO">LUMO</option>
                        <option value="HOMO-1">HOMO-1</option>
                        <option value="LUMO+1">LUMO+1</option>
                    </select>
                    <input type="number" id="orbital2" placeholder="Enter index">
                </div>
                <div class="orbital-info" id="orbital2-info">
                    Reference: HOMO = <span id="homo-index2">...</span>, LUMO = <span id="lumo-index2">...</span>
                </div>
                <div class="energy-value" id="energy2"></div>
            </div>
        </div>
        
        <div class="energy-gap">
            <h3>Energy Gap:</h3>
            <div id="gap-value">Calculating...</div>
        </div>
        
        <div class="chart-container">
            <canvas id="energyChart"></canvas>
        </div>
        
        <div class="error" id="error-message"></div>
    </div>

    <script>
        let orbitalData = {
            energies: [],
            homoIndex: null,
            lumoIndex: null
        };
        
        let chart = null;

        function handleSelectChange(orbitalId) {
            const select = document.getElementById(`${orbitalId}-select`);
            const input = document.getElementById(orbitalId);
            
            switch(select.value) {
                case 'HOMO':
                    input.value = orbitalData.homoIndex;
                    break;
                case 'LUMO':
                    input.value = orbitalData.lumoIndex;
                    break;
                case 'HOMO-1':
                    input.value = orbitalData.homoIndex - 1;
                    break;
                case 'LUMO+1':
                    input.value = orbitalData.lumoIndex + 1;
                    break;
                case 'custom':
                    input.value = '';
                    break;
            }
            
            updateCalculations();
        }
        
        // 读取轨道能量数据
        async function loadOrbitalData() {
            try {
                // 读取轨道能量值
                const energiesResponse = await fetch('orbitals.txt');
                const energiesText = await energiesResponse.text();
                orbitalData.energies = energiesText.trim().split('\n').map(Number);
                
                // 读取HOMO/LUMO位置信息
                const infoResponse = await fetch('orbital_info.json');
                const info = await infoResponse.json();
                orbitalData.homoIndex = info.HOMO;
                orbitalData.lumoIndex = info.LUMO;
                
                // 更新参考信息
                updateReferenceInfo();
                
                // 设置初始值
                document.getElementById('orbital1').value = orbitalData.lumoIndex;
                document.getElementById('orbital2').value = orbitalData.homoIndex;
                
                initializeChart();
                updateCalculations();
            } catch (error) {
                showError('Error loading orbital data: ' + error.message);
            }
        }
        
        function updateReferenceInfo() {
            // 更新两个输入框的参考信息
            ['1', '2'].forEach(suffix => {
                document.getElementById(`homo-index${suffix}`).textContent = orbitalData.homoIndex;
                document.getElementById(`lumo-index${suffix}`).textContent = orbitalData.lumoIndex;
            });
        }
        
        function getOrbitalIndex(orbitalInput) {
            if (!orbitalInput) return null;
            const index = parseInt(orbitalInput);
            return isNaN(index) ? null : index;
        }
        
        function updateCalculations() {
            const orbital1 = document.getElementById('orbital1').value;
            const orbital2 = document.getElementById('orbital2').value;
            
            const index1 = getOrbitalIndex(orbital1);
            const index2 = getOrbitalIndex(orbital2);
            
            if (index1 !== null && index1 >= 0 && index1 < orbitalData.energies.length) {
                const energy1 = orbitalData.energies[index1];
                document.getElementById('energy1').textContent = `Energy: ${energy1.toFixed(4)} eV`;
            }
            
            if (index2 !== null && index2 >= 0 && index2 < orbitalData.energies.length) {
                const energy2 = orbitalData.energies[index2];
                document.getElementById('energy2').textContent = `Energy: ${energy2.toFixed(4)} eV`;
            }
            
            if (index1 !== null && index2 !== null) {
                const gap = Math.abs(orbitalData.energies[index1] - orbitalData.energies[index2]);
                document.getElementById('gap-value').textContent = `${gap.toFixed(4)} eV`;
            }
            
            updateChartHighlights(index1, index2);
        }
        
        function initializeChart() {
            const ctx = document.getElementById('energyChart').getContext('2d');
            
            const labels = orbitalData.energies.map((_, index) => index);
            const datasets = [{
                label: 'Orbital Energies',
                data: orbitalData.energies,
                borderColor: '#2196f3',
                backgroundColor: 'rgba(33, 150, 243, 0.1)',
                pointRadius: 0,
                borderWidth: 1
            }];
            
            if (chart) {
                chart.destroy();
            }
            
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            title: {
                                display: true,
                                text: 'Energy (eV)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Orbital Index'
                            }
                        }
                    }
                }
            });
        }
        
        function updateChartHighlights(index1, index2) {
            if (!chart) return;
            
            const highlightData = orbitalData.energies.map((energy, index) => {
                if (index === index1 || index === index2) {
                    return energy;
                }
                return null;
            });
            
            if (chart.data.datasets.length > 1) {
                chart.data.datasets.pop();
            }
            
            chart.data.datasets.push({
                label: 'Selected Orbitals',
                data: highlightData,
                borderColor: '#f44336',
                backgroundColor: '#f44336',
                pointRadius: 6,
                pointHoverRadius: 8,
                showLine: false
            });
            
            chart.update();
        }
        
        function showError(message) {
            const errorElement = document.getElementById('error-message');
            errorElement.textContent = message;
            errorElement.style.display = 'block';
        }
        
        // 添加事件监听器
        document.getElementById('orbital1').addEventListener('input', updateCalculations);
        document.getElementById('orbital2').addEventListener('input', updateCalculations);
        
        // 初始加载数据
        loadOrbitalData();
    </script>
</body>
</html>